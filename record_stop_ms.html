<!DOCTYPE HTML>
<html>
<head>
<title>Test MediaRecorder can't record the stopped media stream</title>
</head>
<body>
<pre id="test">
<script class="testbody" type="text/javascript">
var mr;
var passed = "truthy";
var recordcount = 0;
var a = document.createElement('audio');

function dataavailable(e) {
  ok(e.data.size > 0, "can get data from encoder");
}

//encoder only support 48k/16k mono audio channel
  document.body.appendChild(a);
  a.src = "dtmfmono48k.ogg";
  stream = a.mozCaptureStreamUntilEnded();
  a.onended = function() {
    document.mr = new MediaRecorder(stream);
    document.mr.ondataavailable = dataavailable;
    document.mr.start(1000);
    alert(document.mr.state);
  }
  a.play();
</script>
</pre>
</body>
</html>
